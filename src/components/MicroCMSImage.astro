---
import { Image } from "astro:assets";
import type { ImageQuality } from "astro";
import type { MicroCMSImage } from "../apis/type";
import { getWidthHeight } from "../utils/image-sizing";
import { getWebpLosslessSrc } from "../utils/imgix";

export interface Props {
  src: MicroCMSImage;
  class: string;
  alt: string;
  maxWidth?: number;
  maxHeight?: number;
  quality?: ImageQuality;
}

const {
  src,
  class: className,
  alt,
  maxWidth,
  maxHeight,
  quality,
  /** You need to pass ...rest to also pass data-astro-cid-* attributes,
   *  which is used for default scoped styling in Astro.
   * @see https://docs.astro.build/en/guides/styling/#passing-a-class-to-a-child-component
   */
  ...rest
} = Astro.props;

const { width, height } = getWidthHeight({
  src,
  maxWidth,
  maxHeight,
});
---

<Image
  src={getWebpLosslessSrc(src.url)}
  class={className}
  alt={alt}
  quality={quality}
  width={width}
  height={height}
  {...rest}
/>
